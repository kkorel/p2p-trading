"use strict";
/**
 * Simple Logger with transaction_id and action tracking
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.createLogger = createLogger;
function formatLog(level, message, context) {
    const timestamp = new Date().toISOString();
    const parts = [
        `[${timestamp}]`,
        `[${level}]`,
    ];
    if (context?.service) {
        parts.push(`[${context.service}]`);
    }
    if (context?.action) {
        parts.push(`[${context.action}]`);
    }
    if (context?.transaction_id) {
        parts.push(`[txn:${context.transaction_id.substring(0, 8)}]`);
    }
    if (context?.message_id) {
        parts.push(`[msg:${context.message_id.substring(0, 8)}]`);
    }
    parts.push(message);
    return parts.join(' ');
}
function createLogger(service) {
    return {
        info(message, context) {
            console.log(formatLog('INFO', message, { ...context, service }));
        },
        warn(message, context) {
            console.warn(formatLog('WARN', message, { ...context, service }));
        },
        error(message, context) {
            console.error(formatLog('ERROR', message, { ...context, service }));
        },
        debug(message, context) {
            if (process.env.DEBUG) {
                console.log(formatLog('DEBUG', message, { ...context, service }));
            }
        },
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9nZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibG9nZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7QUFzQ0gsb0NBb0JDO0FBaERELFNBQVMsU0FBUyxDQUFDLEtBQWEsRUFBRSxPQUFlLEVBQUUsT0FBb0I7SUFDckUsTUFBTSxTQUFTLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUMzQyxNQUFNLEtBQUssR0FBRztRQUNaLElBQUksU0FBUyxHQUFHO1FBQ2hCLElBQUksS0FBSyxHQUFHO0tBQ2IsQ0FBQztJQUVGLElBQUksT0FBTyxFQUFFLE9BQU8sRUFBRSxDQUFDO1FBQ3JCLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxPQUFPLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQztJQUNyQyxDQUFDO0lBRUQsSUFBSSxPQUFPLEVBQUUsTUFBTSxFQUFFLENBQUM7UUFDcEIsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO0lBQ3BDLENBQUM7SUFFRCxJQUFJLE9BQU8sRUFBRSxjQUFjLEVBQUUsQ0FBQztRQUM1QixLQUFLLENBQUMsSUFBSSxDQUFDLFFBQVEsT0FBTyxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNoRSxDQUFDO0lBRUQsSUFBSSxPQUFPLEVBQUUsVUFBVSxFQUFFLENBQUM7UUFDeEIsS0FBSyxDQUFDLElBQUksQ0FBQyxRQUFRLE9BQU8sQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDNUQsQ0FBQztJQUVELEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7SUFFcEIsT0FBTyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ3pCLENBQUM7QUFFRCxTQUFnQixZQUFZLENBQUMsT0FBZTtJQUMxQyxPQUFPO1FBQ0wsSUFBSSxDQUFDLE9BQWUsRUFBRSxPQUFxQztZQUN6RCxPQUFPLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLEVBQUUsR0FBRyxPQUFPLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ25FLENBQUM7UUFFRCxJQUFJLENBQUMsT0FBZSxFQUFFLE9BQXFDO1lBQ3pELE9BQU8sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsRUFBRSxHQUFHLE9BQU8sRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDcEUsQ0FBQztRQUVELEtBQUssQ0FBQyxPQUFlLEVBQUUsT0FBcUM7WUFDMUQsT0FBTyxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxFQUFFLEdBQUcsT0FBTyxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQztRQUN0RSxDQUFDO1FBRUQsS0FBSyxDQUFDLE9BQWUsRUFBRSxPQUFxQztZQUMxRCxJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBQ3RCLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLE9BQU8sRUFBRSxPQUFPLEVBQUUsRUFBRSxHQUFHLE9BQU8sRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDcEUsQ0FBQztRQUNILENBQUM7S0FDRixDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU2ltcGxlIExvZ2dlciB3aXRoIHRyYW5zYWN0aW9uX2lkIGFuZCBhY3Rpb24gdHJhY2tpbmdcbiAqL1xuXG5leHBvcnQgaW50ZXJmYWNlIExvZ0NvbnRleHQge1xuICB0cmFuc2FjdGlvbl9pZD86IHN0cmluZztcbiAgbWVzc2FnZV9pZD86IHN0cmluZztcbiAgYWN0aW9uPzogc3RyaW5nO1xuICBzZXJ2aWNlPzogc3RyaW5nO1xuICBba2V5OiBzdHJpbmddOiBhbnk7IC8vIEFsbG93IGFkZGl0aW9uYWwgcHJvcGVydGllc1xufVxuXG5mdW5jdGlvbiBmb3JtYXRMb2cobGV2ZWw6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCk6IHN0cmluZyB7XG4gIGNvbnN0IHRpbWVzdGFtcCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgY29uc3QgcGFydHMgPSBbXG4gICAgYFske3RpbWVzdGFtcH1dYCxcbiAgICBgWyR7bGV2ZWx9XWAsXG4gIF07XG4gIFxuICBpZiAoY29udGV4dD8uc2VydmljZSkge1xuICAgIHBhcnRzLnB1c2goYFske2NvbnRleHQuc2VydmljZX1dYCk7XG4gIH1cbiAgXG4gIGlmIChjb250ZXh0Py5hY3Rpb24pIHtcbiAgICBwYXJ0cy5wdXNoKGBbJHtjb250ZXh0LmFjdGlvbn1dYCk7XG4gIH1cbiAgXG4gIGlmIChjb250ZXh0Py50cmFuc2FjdGlvbl9pZCkge1xuICAgIHBhcnRzLnB1c2goYFt0eG46JHtjb250ZXh0LnRyYW5zYWN0aW9uX2lkLnN1YnN0cmluZygwLCA4KX1dYCk7XG4gIH1cbiAgXG4gIGlmIChjb250ZXh0Py5tZXNzYWdlX2lkKSB7XG4gICAgcGFydHMucHVzaChgW21zZzoke2NvbnRleHQubWVzc2FnZV9pZC5zdWJzdHJpbmcoMCwgOCl9XWApO1xuICB9XG4gIFxuICBwYXJ0cy5wdXNoKG1lc3NhZ2UpO1xuICBcbiAgcmV0dXJuIHBhcnRzLmpvaW4oJyAnKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUxvZ2dlcihzZXJ2aWNlOiBzdHJpbmcpIHtcbiAgcmV0dXJuIHtcbiAgICBpbmZvKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IE9taXQ8TG9nQ29udGV4dCwgJ3NlcnZpY2UnPikge1xuICAgICAgY29uc29sZS5sb2coZm9ybWF0TG9nKCdJTkZPJywgbWVzc2FnZSwgeyAuLi5jb250ZXh0LCBzZXJ2aWNlIH0pKTtcbiAgICB9LFxuICAgIFxuICAgIHdhcm4obWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogT21pdDxMb2dDb250ZXh0LCAnc2VydmljZSc+KSB7XG4gICAgICBjb25zb2xlLndhcm4oZm9ybWF0TG9nKCdXQVJOJywgbWVzc2FnZSwgeyAuLi5jb250ZXh0LCBzZXJ2aWNlIH0pKTtcbiAgICB9LFxuICAgIFxuICAgIGVycm9yKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IE9taXQ8TG9nQ29udGV4dCwgJ3NlcnZpY2UnPikge1xuICAgICAgY29uc29sZS5lcnJvcihmb3JtYXRMb2coJ0VSUk9SJywgbWVzc2FnZSwgeyAuLi5jb250ZXh0LCBzZXJ2aWNlIH0pKTtcbiAgICB9LFxuICAgIFxuICAgIGRlYnVnKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IE9taXQ8TG9nQ29udGV4dCwgJ3NlcnZpY2UnPikge1xuICAgICAgaWYgKHByb2Nlc3MuZW52LkRFQlVHKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGZvcm1hdExvZygnREVCVUcnLCBtZXNzYWdlLCB7IC4uLmNvbnRleHQsIHNlcnZpY2UgfSkpO1xuICAgICAgfVxuICAgIH0sXG4gIH07XG59XG4iXX0=