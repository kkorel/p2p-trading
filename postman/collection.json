{
  "info": {
    "_postman_id": "p2p-energy-trading-beckn-v2",
    "name": "P2P Energy Trading - Beckn v2",
    "description": "Beckn v2 P2P Energy Trading MVP - Phase 1\\n\\nThis collection demonstrates the complete trade placement flow:\\n- discover → on_discover\\n- select → on_select\\n- init → on_init\\n- confirm → on_confirm\\n- status → on_status",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Health Checks",
      "item": [
        {
          "name": "BAP Health",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{bap_url}}/health",
              "host": ["{{bap_url}}"],
              "path": ["health"]
            }
          }
        },
        {
          "name": "CDS Health",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{cds_url}}/health",
              "host": ["{{cds_url}}"],
              "path": ["health"]
            }
          }
        },
        {
          "name": "BPP Health",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{bpp_url}}/health",
              "host": ["{{bpp_url}}"],
              "path": ["health"]
            }
          }
        }
      ]
    },
    {
      "name": "Trade Flow (via BAP)",
      "item": [
        {
          "name": "1. Discover - Find Solar Offers",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "if (jsonData.transaction_id) {",
                  "    pm.environment.set('transaction_id', jsonData.transaction_id);",
                  "    console.log('Set transaction_id:', jsonData.transaction_id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"sourceType\": \"SOLAR\",\n  \"deliveryMode\": \"INSTANT\",\n  \"minQuantity\": 20,\n  \"timeWindow\": {\n    \"startTime\": \"2026-01-18T11:00:00Z\",\n    \"endTime\": \"2026-01-18T15:00:00Z\"\n  }\n}"
            },
            "url": {
              "raw": "{{bap_url}}/api/discover",
              "host": ["{{bap_url}}"],
              "path": ["api", "discover"]
            },
            "description": "Initiate catalog discovery for SOLAR energy with INSTANT delivery.\\n\\nThis sends a discover request to CDS, which filters the catalog and sends on_discover callback to BAP."
          }
        },
        {
          "name": "2. Select - Choose Best Offer (Auto Match)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "if (jsonData.selected_offer && jsonData.selected_offer.id) {",
                  "    pm.environment.set('offer_id', jsonData.selected_offer.id);",
                  "    console.log('Selected offer:', jsonData.selected_offer.id);",
                  "}",
                  "if (jsonData.matching) {",
                  "    console.log('Matching score:', jsonData.matching.score);",
                  "    console.log('Breakdown:', JSON.stringify(jsonData.matching.breakdown));",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"transaction_id\": \"{{transaction_id}}\",\n  \"quantity\": 30,\n  \"autoMatch\": true,\n  \"requestedTimeWindow\": {\n    \"startTime\": \"2026-01-18T11:00:00Z\",\n    \"endTime\": \"2026-01-18T15:00:00Z\"\n  }\n}"
            },
            "url": {
              "raw": "{{bap_url}}/api/select",
              "host": ["{{bap_url}}"],
              "path": ["api", "select"]
            },
            "description": "Select an offer using the matching algorithm.\\n\\nWith autoMatch=true, the BAP applies multi-criteria scoring (price 40%, trust 35%, time fit 25%) to select the best offer."
          }
        },
        {
          "name": "2b. Select - Manual Offer Selection",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"transaction_id\": \"{{transaction_id}}\",\n  \"offer_id\": \"{{offer_id}}\",\n  \"item_id\": \"{{item_id}}\",\n  \"quantity\": 30\n}"
            },
            "url": {
              "raw": "{{bap_url}}/api/select",
              "host": ["{{bap_url}}"],
              "path": ["api", "select"]
            },
            "description": "Manually select a specific offer by ID (alternative to auto-match)."
          }
        },
        {
          "name": "3. Init - Initialize Order",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Order ID will be set via on_init callback",
                  "console.log('Init request sent, waiting for on_init callback...');"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"transaction_id\": \"{{transaction_id}}\"\n}"
            },
            "url": {
              "raw": "{{bap_url}}/api/init",
              "host": ["{{bap_url}}"],
              "path": ["api", "init"]
            },
            "description": "Initialize the order.\\n\\nBPP creates the order in PENDING status and sends on_init callback."
          }
        },
        {
          "name": "4. Get Transaction State",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "if (jsonData.order && jsonData.order.id) {",
                  "    pm.environment.set('order_id', jsonData.order.id);",
                  "    console.log('Order ID:', jsonData.order.id);",
                  "    console.log('Order Status:', jsonData.order.status);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{bap_url}}/api/transactions/{{transaction_id}}",
              "host": ["{{bap_url}}"],
              "path": ["api", "transactions", "{{transaction_id}}"]
            },
            "description": "Get the current transaction state including the order ID from on_init callback."
          }
        },
        {
          "name": "5. Confirm - Activate Order",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"transaction_id\": \"{{transaction_id}}\",\n  \"order_id\": \"{{order_id}}\"\n}"
            },
            "url": {
              "raw": "{{bap_url}}/api/confirm",
              "host": ["{{bap_url}}"],
              "path": ["api", "confirm"]
            },
            "description": "Confirm the order.\\n\\nBPP activates the order (status becomes ACTIVE) and sends on_confirm callback.\\n\\nThis operation is idempotent - calling it again with the same transaction_id won't create duplicate orders."
          }
        },
        {
          "name": "6. Status - Check Order Status",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"transaction_id\": \"{{transaction_id}}\",\n  \"order_id\": \"{{order_id}}\"\n}"
            },
            "url": {
              "raw": "{{bap_url}}/api/status",
              "host": ["{{bap_url}}"],
              "path": ["api", "status"]
            },
            "description": "Query the current order status.\\n\\nBPP returns the order status and fulfillment state via on_status callback."
          }
        }
      ]
    },
    {
      "name": "Direct Beckn Calls",
      "item": [
        {
          "name": "Discover (Direct to CDS)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"context\": {\n    \"domain\": \"energy:trading:p2p\",\n    \"version\": \"2.0.0\",\n    \"action\": \"discover\",\n    \"timestamp\": \"{{$isoTimestamp}}\",\n    \"message_id\": \"{{$guid}}\",\n    \"transaction_id\": \"{{$guid}}\",\n    \"bap_id\": \"{{bap_id}}\",\n    \"bap_uri\": \"{{bap_uri}}\",\n    \"ttl\": \"PT30S\"\n  },\n  \"message\": {\n    \"intent\": {\n      \"item\": {\n        \"itemAttributes\": {\n          \"sourceType\": \"SOLAR\",\n          \"deliveryMode\": \"INSTANT\",\n          \"availableQuantity\": 20\n        }\n      },\n      \"fulfillment\": {\n        \"time\": {\n          \"startTime\": \"2026-01-18T10:00:00Z\",\n          \"endTime\": \"2026-01-18T16:00:00Z\"\n        }\n      }\n    },\n    \"filters\": {\n      \"type\": \"jsonpath\",\n      \"expression\": \"sourceType='SOLAR' && deliveryMode='INSTANT' && availableQuantity>=20\"\n    }\n  }\n}"
            },
            "url": {
              "raw": "{{cds_url}}/discover",
              "host": ["{{cds_url}}"],
              "path": ["discover"]
            },
            "description": "Direct Beckn discover call to CDS (bypassing BAP for testing)."
          }
        },
        {
          "name": "Select (Direct to BPP)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"context\": {\n    \"domain\": \"energy:trading:p2p\",\n    \"version\": \"2.0.0\",\n    \"action\": \"select\",\n    \"timestamp\": \"{{$isoTimestamp}}\",\n    \"message_id\": \"{{$guid}}\",\n    \"transaction_id\": \"{{transaction_id}}\",\n    \"bap_id\": \"{{bap_id}}\",\n    \"bap_uri\": \"{{bap_uri}}\",\n    \"bpp_id\": \"{{bpp_id}}\",\n    \"bpp_uri\": \"{{bpp_uri}}\",\n    \"ttl\": \"PT30S\"\n  },\n  \"message\": {\n    \"orderItems\": [\n      {\n        \"item_id\": \"item-solar-001\",\n        \"offer_id\": \"offer-alpha-morning\",\n        \"quantity\": 30\n      }\n    ]\n  }\n}"
            },
            "url": {
              "raw": "{{bpp_url}}/select",
              "host": ["{{bpp_url}}"],
              "path": ["select"]
            }
          }
        }
      ]
    },
    {
      "name": "Phase-3 Flow",
      "item": [
        {
          "name": "1. Start Verification",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "var jsonData = pm.response.json();",
                  "if (jsonData.verification_case_id) {",
                  "    pm.environment.set('verification_case_id', jsonData.verification_case_id);",
                  "    console.log('Verification case ID:', jsonData.verification_case_id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"verification_window\": {\n    \"startTime\": \"2026-01-18T11:00:00Z\",\n    \"endTime\": \"2026-01-18T15:00:00Z\"\n  },\n  \"required_proofs\": [\n    {\n      \"type\": \"METER_READING\",\n      \"source\": \"meter-123\",\n      \"deadline\": \"2026-01-18T16:00:00Z\"\n    }\n  ],\n  \"expected_quantity\": {\n    \"value\": 30,\n    \"unit\": \"kWh\"\n  },\n  \"tolerance_rules\": {\n    \"max_deviation_percent\": 5.0,\n    \"min_quantity\": 28.5\n  }\n}"
            },
            "url": {
              "raw": "{{bap_url}}/phase3/orders/{{order_id}}/verification/start",
              "host": ["{{bap_url}}"],
              "path": ["phase3", "orders", "{{order_id}}", "verification", "start"]
            },
            "description": "Start verification for an ACTIVE order. Requires order_id from Phase-1."
          }
        },
        {
          "name": "2. Submit Proofs",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"proofs\": [\n    {\n      \"type\": \"METER_READING\",\n      \"source\": \"meter-123\",\n      \"timestamp\": \"2026-01-18T12:00:00Z\",\n      \"value\": {\n        \"quantity\": 15.5,\n        \"unit\": \"kWh\"\n      },\n      \"metadata\": {\n        \"reading_type\": \"START\"\n      }\n    },\n    {\n      \"type\": \"METER_READING\",\n      \"source\": \"meter-123\",\n      \"timestamp\": \"2026-01-18T14:30:00Z\",\n      \"value\": {\n        \"quantity\": 14.5,\n        \"unit\": \"kWh\"\n      },\n      \"metadata\": {\n        \"reading_type\": \"END\"\n      }\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{bap_url}}/phase3/orders/{{order_id}}/proofs",
              "host": ["{{bap_url}}"],
              "path": ["phase3", "orders", "{{order_id}}", "proofs"]
            },
            "description": "Submit proof artifacts (meter readings, telemetry, etc.) for verification."
          }
        },
        {
          "name": "3. Accept Verification",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{}"
            },
            "url": {
              "raw": "{{bap_url}}/phase3/orders/{{order_id}}/verification/accept",
              "host": ["{{bap_url}}"],
              "path": ["phase3", "orders", "{{order_id}}", "verification", "accept"]
            },
            "description": "Buyer accepts the verification result."
          }
        },
        {
          "name": "3b. Reject Verification (Negative Path)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"reason\": \"Quantity mismatch\"\n}"
            },
            "url": {
              "raw": "{{bap_url}}/phase3/orders/{{order_id}}/verification/reject",
              "host": ["{{bap_url}}"],
              "path": ["phase3", "orders", "{{order_id}}", "verification", "reject"]
            },
            "description": "Buyer rejects the verification result (creates dispute)."
          }
        },
        {
          "name": "4. Start Settlement",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"settlement_type\": \"DAILY\",\n  \"period\": {\n    \"startTime\": \"2026-01-18T00:00:00Z\",\n    \"endTime\": \"2026-01-18T23:59:59Z\"\n  }\n}"
            },
            "url": {
              "raw": "{{bap_url}}/phase3/orders/{{order_id}}/settlement/start",
              "host": ["{{bap_url}}"],
              "path": ["phase3", "orders", "{{order_id}}", "settlement", "start"]
            },
            "description": "Initiate settlement after verification success."
          }
        },
        {
          "name": "5. Get Verification & Settlement State",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{bap_url}}/phase3/orders/{{order_id}}",
              "host": ["{{bap_url}}"],
              "path": ["phase3", "orders", "{{order_id}}"]
            },
            "description": "Get current verification and settlement state for an order."
          }
        },
        {
          "name": "6. Get Events",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{bap_url}}/phase3/orders/{{order_id}}/events",
              "host": ["{{bap_url}}"],
              "path": ["phase3", "orders", "{{order_id}}", "events"]
            },
            "description": "Inspect all protocol events for an order."
          }
        }
      ]
    },
    {
      "name": "Utilities",
      "item": [
        {
          "name": "List All Transactions",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{bap_url}}/api/transactions",
              "host": ["{{bap_url}}"],
              "path": ["api", "transactions"]
            }
          }
        }
      ]
    }
  ]
}
